<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Question√°rio de Ado√ß√£o</title>
    <link rel="stylesheet" href="/static/estilo.css">
</head>
<body>

    <h1>Voc√™ est√° apto a adotar um animal?</h1>

    <form id="questionario">
        
    </form>

    <button onclick="verificar()">Verificar Aptid√£o</button>

    <div id="resultado"></div>

    <script>
        const perguntas = [
            "Voc√™ tem tempo di√°rio para cuidar do animal?",
            "Voc√™ tem recursos financeiros para cuidar de um pet?",
            "Voc√™ j√° pesquisou sobre as necessidades do animal?",
            "Voc√™ aceita responsabilidade de longo prazo?",
            "Todos na casa concordam com a ado√ß√£o?",
            "Voc√™ tem espa√ßo adequado?",
            "Voc√™ sabe qual animal √© ideal para seu estilo de vida?",
            "Voc√™ se compromete a n√£o abandonar o animal?",
            "Voc√™ tem paci√™ncia para treinar e educar?",
            "Voc√™ tem tempo para passear (se for cachorro) ou ajudar o animal a gastar sua energia em geral?",
            "Voc√™ considera o animal parte da fam√≠lia?",
            "Voc√™ est√° disposto a levar ao veterin√°rio regularmente?",
            "Voc√™ sabe o que o animal pode ou n√£o comer?",
            "Voc√™ lida bem com o fato de que o animal pode ficar doente e envelhecer?",
            "Voc√™ est√° adotando de forma respons√°vel e n√£o por impulso?"
        ];

        const form = document.getElementById("questionario");

        perguntas.forEach((pergunta, index) => {
            const div = document.createElement("div");
            div.className = "pergunta";
            div.innerHTML = `
                <label>${index + 1}. ${pergunta}</label><br>
                <input type="radio" name="q${index}" value="sim" required> Sim
                <input type="radio" name="q${index}" value="nao" required> N√£o
            `;
            form.appendChild(div);
        });

        async function salvarResultado(nome, totalSim) {
            try {
                console.log("üì§ Enviando dados:", { nome_usuario: nome, total_sim: totalSim });
                
                const response = await fetch('/salvar_resultado_teste', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        nome_usuario: nome,
                        total_sim: totalSim
                    })
                });
                
                const data = await response.json();
                console.log("üì• Resposta do servidor:", data);
                return data.success;
            } catch (error) {
                console.error('‚ùå Erro ao salvar resultado:', error);
                return false;
            }
        }

        async function verificar() {
            let respostas = document.querySelectorAll('input[type="radio"]:checked');
            let totalSim = 0;

            respostas.forEach(radio => {
                if (radio.value === "sim") {
                    totalSim++;
                }
            });

            const resultado = document.getElementById("resultado");

            
            if (respostas.length < perguntas.length) {
                resultado.innerHTML = "‚ùå Responda TODAS as perguntas antes de continuar.";
                resultado.style.color = "orange";
                return;
            }

            
            const nomeUsuario = prompt("Por favor, digite seu nome para registrar o resultado do teste:");
            
            if (!nomeUsuario || nomeUsuario.trim() === "") {
                resultado.innerHTML = "‚ùå √â necess√°rio informar o nome para registrar o teste.";
                resultado.style.color = "orange";
                return;
            }

            resultado.innerHTML = "‚è≥ Salvando resultado...";
            resultado.style.color = "blue";

            
            const salvou = await salvarResultado(nomeUsuario.trim(), totalSim);
            
            if (salvou) {
                if (totalSim > 7) {
                    resultado.innerHTML = `‚úÖ Parab√©ns ${nomeUsuario}! Voc√™ est√° apto para ado√ß√£o! Redirecionando...`;
                    resultado.style.color = "yellow";
                    
                    
                    setTimeout(() => {
                        window.location.href = "/localizacao";
                    }, 2000);
                } else {
                    resultado.innerHTML = `‚ùå ${nomeUsuario}, voc√™ ainda n√£o est√° apto a adotar. Considere se preparar melhor.`;
                    resultado.style.color = "red";
                }
            } else {
                resultado.innerHTML = "‚ùå Erro ao salvar resultado. Tente novamente.";
                resultado.style.color = "red";
            }
        }
    </script>

</body>
</html>